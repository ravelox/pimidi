#!/bin/bash -x

FULLDIRPATH=$(pwd)
#
# Define the local build directory
#
BUILDDIR=${FULLDIRPATH}/build

export DESTDIR=${BUILDDIR}/@PACKAGE@_@VERSION@-1
make install

for SUBPACKAGE in server lib dev
do
	SUBPACKAGEDIR=${BUILDDIR}/@PACKAGE@-${SUBPACKAGE}_@VERSION@-1
	CONTROLFILE=${FULLDIRPATH}/DEBIAN/@PACKAGE@-${SUBPACKAGE}.control
	FILELIST=${FULLDIRPATH}/DEBIAN/@PACKAGE@-${SUBPACKAGE}.files

	mkdir -p ${SUBPACKAGEDIR}/DEBIAN
	cp -R ${CONTROLFILE} ${SUBPACKAGEDIR}/DEBIAN/control

	OLDDIR=${FULLDIRPATH}
	cd ${DESTDIR}
	tar  -czvf - --files-from=${FILELIST} | tar -C ${SUBPACKAGEDIR} -xzf -
	cd ${OLDDIR}

	cd ${BUILDDIR}
	dpkg-deb --build @PACKAGE@-${SUBPACKAGE}_@VERSION@-1
	cd ${OLDDIR}

	rm -Rf ${SUBPACKAGEDIR}

done

cd ${FULLDIRPATH}
rm -Rf ${DESTDIR}

